" s exceed the preset cut time of ", cut_time,
" s. Because long measurements may lead to over-fitting and imprecise fast-decaying component fitting, all records are reduced to the cut time."))
# cut records
lum_data <- prepare_OSLdata(lum_data,
record.type = record_type,
cut.time = cut_time)
applied_time_cut <- TRUE
}
if (!is.null(background_selection)) {
cat(paste0("* Aliquot ", background_selection_text,
" is set as background measurement. All OSL records are combined to a mean curve. This mean curve is subtracted from all other records of the data set."))
# cut records
lum_data <- prepare_OSLdata(lum_data,
record.type = record_type,
background.aliquot = background_selection,
background.plot = TRUE)
cat(paste0("<pre>*Figure ", n.figure,": Mean curve of background measurements (blue) and data points of all background measurement (black)*"))
n.figure <- n.figure + 1
}
if (single_grain) {
# cut records
lum_data <- prepare_OSLdata(lum_data,
record.type = record_type,
tailor.single.grain = TRUE)
}
# find components via fitting and F-statistics
C.list <- fit_OSLcurve(global_curve,
K.max = max_components,
F.threshold = F_threshold,
stimulation.intensity = stimulation_intensity,
stimulation.wavelength = stimulation_wavelength,
applied.time.cut = applied_time_cut,
background.fitting = FALSE,
verbose = FALSE,
output.plot = FALSE)
K.selected <- C.list$K.selected
SAR.list <- list(NULL)
# Classic late background signal calculation:
components.late <- calc_classicOSLsignal(global_curve,
algorithm = "late",
stimulation.intensity = stimulation_intensity,
verbose = FALSE)
SAR.list[[1]] <- decompose_SARdata(lum_data,
components = components.late,
record_type = record_type,
algorithm = "late",
dose.rate = dose_rate,
recuperation_rate = recuperation_rate,
recycling_ratio = recycling_ratio,
applied.pre.dose = applied_predose,
fit.method = fit_method,
verbose = FALSE)
# Classic early background signal calculation:
components.early <- calc_classicOSLsignal(global_curve,
algorithm = "early",
stimulation.intensity = stimulation_intensity,
verbose = FALSE)
SAR.list[[2]] <- decompose_SARdata(lum_data,
components = components.early,
record_type = record_type,
algorithm = "early",
dose.rate = dose_rate,
recuperation_rate = recuperation_rate,
recycling_ratio = recycling_ratio,
applied.pre.dose = applied_predose,
fit.method = fit_method,
verbose = FALSE)
2^16
(2^16)^2
(2^16)^2 / 1000
(2^16)^2 / 1000^2
(2^15)^2 / 1000^2
2^3
3^3
8^3
library(Luminescence)
install.packages(c("bbmle", "BH", "callr", "cli", "covr", "curl", "data.table", "DEoptim", "devtools", "digest", "dplyr", "DT", "fansi", "fs", "ggplot2", "ggpubr", "gh", "hms", "htmlwidgets", "jsonlite", "knitr", "later", "Luminescence", "mime", "pillar", "pkgbuild", "plotrix", "plyr", "prettyunits", "processx", "ps", "purrr", "R6", "raster", "Rcpp", "RcppArmadillo", "remotes", "rlang", "rmarkdown", "roxygen2", "rstudioapi", "rversions", "scales", "shiny", "sp", "stringi", "testthat", "tidyr", "tidyselect", "tinytex", "vctrs", "xfun", "XML", "yaml", "zoo"))
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/decompose_DataSet.R')
#Script.date <- "2020-03-06"
#Time.needed <- Sys.time()
library(Luminescence)
library(numOSL)
library(knitr)
library(ggplot2)
library(gridExtra)
library(ggpubr)
library(OSLdecomposition)
# fig.width=6,
knitr::opts_chunk$set(fig.width=7,
fig.asp=.4,
results = "asis",
warning=FALSE,
message=FALSE,
error=FALSE,
echo=FALSE,
cache=FALSE)
# fig.align="center",
#path <- file.choose()
path <- "C:\\Users\\mitte\\Desktop\\OSL decomposition\\application\\BT1713_SAR_classic.bin"
# read BIN file:
lum_data <- read_BIN2R(path,
fastForward = TRUE,
txtProgressBar = FALSE)
#Script.date <- "2020-03-06"
#Time.needed <- Sys.time()
library(Luminescence)
library(numOSL)
library(knitr)
library(ggplot2)
library(gridExtra)
library(ggpubr)
library(OSLdecomposition)
# fig.width=6,
knitr::opts_chunk$set(fig.width=7,
fig.asp=.4,
results = "asis",
warning=FALSE,
message=FALSE,
error=FALSE,
echo=FALSE,
cache=FALSE)
# fig.align="center",
# read BIN file:
lum_data <- read_BIN2R(path,
fastForward = TRUE,
txtProgressBar = FALSE)
# read BIN file:
lum_data <- read_BIN2R(path,
fastForward = TRUE,
txtProgressBar = FALSE)
#path <- file.choose()
path <- "C:\\Users\\mitte\\Desktop\\OSL decomposition\\application\\BT1713\\BT1713_SAR_classic.bin"
# read BIN file:
lum_data <- read_BIN2R(path,
fastForward = TRUE,
txtProgressBar = FALSE)
N.raw <- length(lum_data)
# Data set dependend parameters
record_type <- "OSL"
#drop_selection <-c(1:4)  c(22)
drop_selection <- NULL
drop_selection_text <- "none"
if (!is.null(drop_selection)) drop_selection_text <- paste(drop_selection, collapse = ",")
background_selection <- NULL
background_selection_text <- "none"
if (!is.null(background_selection)) background_selection_text <- paste(background_selection, collapse = ",")
lum_data[drop_selection] <- NULL
example_aliquot <- 1
n.table <- 1
n.figure <- 1
first_aliquot <- lum_data[[1]][[record_type]]
N.aliquots <- length(lum_data) - length(background_selection)
#, fig.cap="Figure `1`: Global mean curve (blue); Data points of all OSL curves (grey opaque); First OSL record of first aliquot (red)."
# calc arithmetic mean curve
global_curve <- sum_OSLcurves(lum_data,
record_type = record_type,
output.plot = TRUE,
plot.first = TRUE,
plot.global = FALSE,
title = NULL,
verbose = FALSE)
cat(paste0("<pre>*Figure ", n.figure,": Raw data points of all OSL curves (grey opaque) and natural dose OSL curve of first aliquot (red)*"))
n.figure <- n.figure + 1
sample_type <- "fine grain quartz"
single_grain <- FALSE
expected_value <- NA # ka or Gy if age_rate = 1
applied_predose <- 0 # same unit as expected
expected_unit <- "Gy"
# values from Maggis Sibirian data sets
# dose_rate <- 4.95 / 60 # Gy/s
#dose_unit <- "Gy" # "s" if dose_rate = 1
#age_rate <- 0.635 # ka/Gy
age_rate <- NA
# Dosisleistung lexsyg bayreuth am 18.06.19
# Grobkorn: 0.0525 ± 0.0028 Gy/s
# Feinkorn: 0.0563 ± 0.0022 Gy/s
dose_rate <- 0.0563 # Gy/s
# dose_rate <- 1 # Gy/s
dose_unit <- "Gy" # "s" if dose_rate = 1
#age_rate <- NA # ka/Gy
# Stimulation parameters
stimulation_wavelength <- 470
stimulation_intensity <- 30  # mW cm^-2
# Algorithm parameters
cut_time <- 40
max_components <- 3
F_threshold <- 50
algorithm <- "det+nls"
### some minor things ###
if (expected_unit == "s") {
expected_dose <- dose_rate * expected_value
applied_predose <- dose_rate * applied_predose
expected_age <- age_rate * expected_dose
} else if (expected_unit == "Gy") {
expected_dose <- expected_value
expected_age <- age_rate * expected_dose
} else if (expected_unit == "ka") {
expected_dose <- expected_value / age_rate
expected_age <- expected_value
}
if (is.finite(expected_dose)) {
digits_DE <- 2 - round(log10(expected_dose))
} else { digits_DE <- 1 }
applied_time_cut <- FALSE
# alter the data
# ToDo:
# - background substraction
# - single grain measurement cut
if (max(global_curve$time) > cut_time) {
cat(paste0("* The measurement duration of ", prettyNum(max(global_curve$time)) ,
" s exceed the preset cut time of ", cut_time,
" s. Because long measurements may lead to over-fitting and imprecise fast-decaying component fitting, all records are reduced to the cut time."))
# cut records
lum_data <- prepare_OSLdata(lum_data,
record.type = record_type,
cut.time = cut_time)
applied_time_cut <- TRUE
}
if (!is.null(background_selection)) {
cat(paste0("* Aliquot ", background_selection_text,
" is set as background measurement. All OSL records are combined to a mean curve. This mean curve is subtracted from all other records of the data set."))
# cut records
lum_data <- prepare_OSLdata(lum_data,
record.type = record_type,
background.aliquot = background_selection,
background.plot = TRUE)
cat(paste0("<pre>*Figure ", n.figure,": Mean curve of background measurements (blue) and data points of all background measurement (black)*"))
n.figure <- n.figure + 1
}
if (single_grain) {
# cut records
lum_data <- prepare_OSLdata(lum_data,
record.type = record_type,
tailor.single.grain = TRUE)
}
# calc arithmetic mean curve, again
global_curve <- sum_OSLcurves(lum_data,
record_type = record_type,
output.plot = TRUE,
plot.first = FALSE,
plot.global = TRUE,
title = NULL,
verbose = FALSE)
cat(paste0("<pre>*Figure ", n.figure,": Global mean ", record_type, " curve (blue) and data points of all OSL records (grey opaque)*"))
n.figure <- n.figure + 1
# find components via fitting and F-statistics
C.list <- fit_OSLcurve(global_curve,
K.max = max_components,
F.threshold = F_threshold,
stimulation.intensity = stimulation_intensity,
stimulation.wavelength = stimulation_wavelength,
applied.time.cut = applied_time_cut,
background.fitting = FALSE,
verbose = FALSE,
output.plot = FALSE)
K.selected <- C.list$K.selected
# find components via fitting and F-statistics
C.list <- fit_OSLcurve(global_curve,
K.max = max_components,
F.threshold = F_threshold,
stimulation.intensity = stimulation_intensity,
stimulation.wavelength = stimulation_wavelength,
applied.time.cut = applied_time_cut,
background.fitting = FALSE,
verbose = FALSE,
output.plot = FALSE)
K.selected <- C.list$K.selected
K.selected
C.list
View(lum_data)
lum_data[[1]]@records[[1]]@components <- 1
lum_data[[1]]@records[[1]][["test"]] <- 1
lum_data[[1]]@records[[1]][["test"]] <- list(NULL)
lum_data[[1]]@records[[1]]@info[["COMPONENTS"]] <- data.frame(a = 1, b = 2)
View(lum_data)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/decompose_DataSet.R')
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/decompose_DataSet.R')
View(C.list)
decompose_DataSet(lum_data, C.list[["components"]])
lum_data <- decompose_DataSet(lum_data, C.list[["components"]])
View(lum_data)
lum_data[[8]]@records[[12]]@info[["COMPONENTS"]]
save.image("C:/Users/mitte/Desktop/R/OSLdecomposition/markdown/Analyze_luminescence_package_test.RData")
load("C:/Users/mitte/Desktop/R/OSLdecomposition/markdown/Analyze_luminescence_package_test.RData")
lum_data[[1:2]]
lum_data[[1,2]]
View(lum_data)
lum_data[[1]]
lum_data[[1:2]]
lum_data[1:2]
lum_data[1,2]
lum_data[c(1,3)]
read_BIN2R()
class(lum_data)
lum_data[2]
lum_data[[2]]
test <- lum_data[2]
test <- lum_data[2, 5]
test <- lum_data[c(2,5)]
test
lum_data[["COMPONENTS"]] <- C.list
View(lum_data)
lum_data[[11]]
lum_data[[1]]@records[[1]]@info$COMPONENTS
?tolower("HehehE")
tolower("HehehE")
tolower("HehehE-_")
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/render_Report.R')
render_Report(lum_data)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/render_Report.R')
render_Report(lum_data)
install.packages("funr")
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/render_Report.R')
render_Report(lum_data)
library(funr)
render_Report(lum_data)
funr::get_script_path()
sessionInfo()
getwd()
install.packages("here")
library(here)
here()
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/render_Report.R')
render_Report(lum_data)
?here
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/render_Report.R')
render_Report(lum_data)
?sys.script()
View(lum_data)
save.image("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
remove.packages("OSLdecomposition", lib="~/R/win-library/3.6")
install.packages("C:/Users/mitte/Desktop/R/OSLdecomposition_0.3.18.tar.gz", repos = NULL, type = "source")
system.file("rmd", "report_HTML.Rmd", package = "OSLdecomposition")
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/render_Report.R')
load("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
render_Report(lum_data)
View(lum_data)
choose.files()
?choose.files()
file.choose(new = FALSE)
file.choose(new = TRUE)
choose.files()
choose.files(default = "report", caption = "Save file",
multi = FALSE, filters = c("html", "pdf","doc"),
index = 3)
getwd()
Sys.time()
Sys.time().Date()
?Sys.time()
Sys.Date()
name(lum_data)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/render_Report.R')
render_Report(lum_data)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/render_Report.R')
render_Report(lum_data)
render_Report(lum_data, "pdf")
save.image("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
installed.packages()
"rmarkdown" %in% rownames(installed.packages())
"rmarkdwn" %in% rownames(installed.packages())
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/render_Report.R')
?append
?list
load("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
class(lum_data[])
class(lum_data[[]])
View(lum_data)
class(lum_data[1:length(lum_data))
class(lum_data[1:length(lum_data)])
lum_data[1:length(lum_data)]
data_set <- NULL
length(data_set)
data_set[[1]] <- "e"
data_set[[2]] <- "e"
data_set <- list()
length(data_set)
names(lum_data)
names(lum_data)[11]
A <- list(1, 2)
A
B <- list(3, 4)
C <- c(A, B)
C
C <- c(A, B, C.list)
C <- c(A, B, list(C.list))
View(C)
C <- c(A, B)
B <- list(Alpha = 3, Beta = 4)
B
C <- c(A, B)
C
C[[3]]
C <- c(A, B, COMPONENTS = C.list)
C <- c(A, B, COMPONENTS = list(C.list))
C
View(C)
View(C.list)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLumData.R')
load("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
View(C.list)
knitr::kable(C.list[["components"]])
cat("Hello")
cat("#1: Hello")
cat("#1 Hello")
?cat
cat("\n#1 Hello", 1)
warning(paste0("List element ", 2, " is not of type 'RLum.Analysis'"))
warning("List element ", 2, " is not of type 'RLum.Analysis'")
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLumData.R')
View(lum_data)
library(OSLdecomposition)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLumData.R')
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLumData.R')
RLum_fit.CW.OSL(lum_data, report = FALSE)
test_data <- RLum_fit.CW.OSL(lum_data, report = FALSE, max_components = 1)
Sys.time()
?Sys.time()
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLumData.R')
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLumData.R')
save.image("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
?try
load("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
library(Luminescence)
library(OSLdecomposition)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLum.CW.OSL.R')
test_data <- fit_RLum.CW.OSL(lum_data)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLum.CW.OSL.R')
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLum.CW.OSL.R')
test_data <- fit_RLum.CW.OSL(lum_data)
?unlist
test <- unlist(C.list)
test
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLum.CW.OSL.R')
test_data <- fit_RLum.CW.OSL(lum_data)
?browseURL
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLum.CW.OSL.R')
View(lum_data)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLum.CW.OSL.R')
test_data <- fit_RLum.CW.OSL(lum_data)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_RLum.CW.OSL.R')
test_data <- fit_RLum.CW.OSL(lum_data, report_format = "doc")
test_data <- fit_RLum.CW.OSL(lum_data, report_format = "word")
save.image("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
test <- lum_data[["COMPONENTS"]][["components"]]
load("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
test <- lum_data[["COMPONENTS"]][["components"]]
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
subset(test, select = c(name, lambda))
View(test)
subset(test, select = c(name, lambda, cross.section, n, SAR.compatible))
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
save.image("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
load("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
cat(test)
print(test)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/decompose_OSLcurve.R')
decompose_OSLcurve(global_curve, C.list$components)
library(OSLdecomposition)
decompose_OSLcurve(global_curve, C.list$components)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/decompose_OSLcurve.R')
decompose_OSLcurve(global_curve, C.list$components)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
components <- C.list$components
sum(components$SAR.compatible)
components$names[components$SAR.compatible == 1]
components$names[components$SAR.compatible == 0]
components$name[components$SAR.compatible == 0]
components$name[components$SAR.compatible == 1]
test_string <- components$name[components$SAR.compatible == 1]
test_string[2]
test_string[1]
paste(test_string, collapse = ", ")
writeLines(1, " ha")
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
fit_OSLcurve(global_curve)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
fit_OSLcurve(global_curve, K.max = 3)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
fit_OSLcurve(global_curve, K.max = 3)
test <- fit_OSLcurve(global_curve, K.max = 3, output.complex = FALSE)
View(test)
formatC(1.193406e-17)
formatC(1.193406e-23)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
test <- fit_OSLcurve(global_curve, K.max = 4, output.complex = TRUE)
View(test)
4:2
1:1
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
formatC(1233.23)
formatC(123.23)
formatC(12.23)
formatC(12222)
formatC(Inf)
formatC("")
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
test <- fit_OSLcurve(global_curve, K.max = 4, output.complex = TRUE)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
test <- fit_OSLcurve(global_curve, K.max = 4, output.complex = TRUE)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
test <- fit_OSLcurve(global_curve, K.max = 3, output.complex = TRUE)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
test <- fit_OSLcurve(global_curve, K.max = 3, output.complex = TRUE)
View(test)
View(test_data)
is.na(test[["F.test"]])
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
test <- fit_OSLcurve(global_curve, K.max = 3, output.complex = TRUE)
source('C:/Users/mitte/Desktop/R/OSLdecomposition/R/fit_OSLcurve.R', encoding = 'UTF-8')
save.image("C:/Users/mitte/Desktop/R/OSLdecomposition/TestSpace.RData")
